<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>今予's Homepage</title>
    <link rel="icon" type="image/jpeg" href="https://s2.loli.net/2024/08/14/UuaJ1elnkKgGChN.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style>
        @font-face {
            font-family: "sakura";
            src: url("./sakura.min.ttf") format("truetype");
        }

        body {
            margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden;
            /* 【视觉升级】回归纯粹深空 
               不再使用动态流光，而是使用极其细腻的径向渐变，模拟宇宙深处的黑暗
            */
            background: radial-gradient(ellipse at bottom center, #1b2735 0%, #131825 30%, #050608 100%);
            font-family: 'sakura', sans-serif;
            user-select: none; -webkit-user-select: none;
        }

        /* 画布 */
        canvas#startrack {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }

        /* 强烈的电影暗角，增加深邃感 */
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 300px rgba(0,0,0,0.95);
            pointer-events: none; z-index: 2;
        }

        .main {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            z-index: 10; perspective: 1200px;
            opacity: 0; transition: opacity 1.5s ease-in-out; /* 更优雅的淡入 */
        }
        .main.loaded { opacity: 1; }

        /* --- 极简玻璃卡片 --- */
        .glass-card {
            position: relative;
            /* 更高的透明度，更纯净 */
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            /* 极细的边框 */
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px; padding: 50px 80px;
            display: flex; flex-direction: column; align-items: center;
            /* 更加柔和弥散的阴影 */
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            transition: transform 0.1s ease-out;
            max-width: 90%; box-sizing: border-box;
        }

        .avatar-container {
            position: relative; width: 130px; height: 130px; margin-bottom: 30px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .avatar-container:hover { transform: scale(1.03); }
        .avatar-container:active { transform: scale(0.97); }

        .avatar-img {
            width: 130px; height: 130px; border-radius: 50%; object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.8); /* 边框变细 */
            /* 更加克制的光晕，显得更高级 */
            box-shadow: 0 0 25px rgba(200, 220, 255, 0.3); z-index: 2;
            transition: all 1s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .spin-warp { animation: warpSpin 0.8s cubic-bezier(0.5, 0, 0.5, 1) forwards; }

        .orbit-ring {
            position: absolute; top: -15px; left: -15px; right: -15px; bottom: -15px;
            border-radius: 50%; 
            /* 极细的轨道线 */
            border: 1px solid rgba(255, 255, 255, 0.15);
            animation: spin 30s linear infinite; transition: all 0.5s;
        }
        .warp-active .orbit-ring {
            border-color: #50ffff; box-shadow: 0 0 30px rgba(80, 255, 255, 0.5);
            border-width: 2px; animation: spin 0.5s linear infinite;
        }
        .warp-active .avatar-img { border-color: #50ffff; box-shadow: 0 0 40px rgba(80, 255, 255, 0.6); }

        .name {
            font-size: 2.8rem; color: #fff; 
            /* 字体发光更加收敛 */
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 12px; text-align: center; font-weight: bold; letter-spacing: 3px;
            white-space: nowrap;
        }

        .role {
            font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); letter-spacing: 2px;
            text-transform: uppercase; font-family: -apple-system, sans-serif; font-weight: 300;
            margin-bottom: 40px; text-align: center;
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 10px;
        }
        .separator { color: rgba(255, 255, 255, 0.3); font-weight: 100; }

        .btns { display: flex; gap: 25px; pointer-events: auto; flex-direction: row; }
        .btn {
            position: relative; padding: 12px 36px; border-radius: 50px;
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.9); text-decoration: none; font-size: 1.1rem; overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer; white-space: nowrap;
            display: flex; justify-content: center; align-items: center; letter-spacing: 1px;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.15); box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            border-color: #fff; transform: translateY(-2px); color: #fff;
        }
        /* 移除流光动画，改为更加稳重的淡入 */
        
        /* UI 组件 */
        #toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff; padding: 10px 20px; border-radius: 4px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            font-size: 12px; letter-spacing: 1px; text-transform: uppercase;
            opacity: 0; transition: all 0.4s ease;
            z-index: 100; pointer-events: none; backdrop-filter: blur(5px);
        }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* 极简风 HUD */
        .speed-hud {
            position: fixed; bottom: 30px; left: 40px; z-index: 50;
            font-family: -apple-system, monospace; color: rgba(255,255,255,0.4);
            font-size: 11px; pointer-events: none;
            display: flex; flex-direction: column; gap: 6px; opacity: 0; transition: opacity 1s;
        }
        .speed-hud.show { opacity: 1; }
        .speed-bar-container { width: 120px; height: 2px; background: rgba(255,255,255,0.1); overflow: hidden; }
        .speed-bar { height: 100%; background: #fff; width: 50%; transition: width 0.1s linear; }

        /* 极简风右键菜单 */
        #context-menu {
            position: fixed; top: 0; left: 0; width: 140px; height: 140px;
            pointer-events: none; z-index: 999;
            opacity: 0; transform: scale(0.8); transition: all 0.2s ease-out;
            display: flex; justify-content: center; align-items: center;
        }
        #context-menu.visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        
        .ctx-ring {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            /* 极细的虚线 */
            border: 1px dashed rgba(255, 255, 255, 0.2); 
            animation: spin 20s linear infinite;
        }
        .ctx-item {
            position: absolute; width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            background: #000; border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; color: #fff; font-family: sans-serif; font-size: 9px; letter-spacing: 1px;
            cursor: pointer; transition: all 0.2s; 
        }
        .ctx-item:hover { background: #fff; color: #000; border-color: #fff; transform: scale(1.1); }
        .ctx-top { top: 0; left: 50%; transform: translateX(-50%); }
        .ctx-bottom { bottom: 0; left: 50%; transform: translateX(-50%); }
        .ctx-left { left: 0; top: 50%; transform: translateY(-50%); }
        .ctx-right { right: 0; top: 50%; transform: translateY(-50%); }

        /* 引导文字 */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .terminal-text {
            color: #ddd; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6;
            max-width: 600px; padding: 20px; opacity: 0.8;
        }
        .cmd-line { display: block; min-height: 20px; }
        .highlight { color: #fff; font-weight: bold; border-bottom: 1px solid #555; padding-bottom: 2px; }
        .system-off { opacity: 0; transition: opacity 0.8s ease; pointer-events: none; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes warpSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(1080deg); } }

        @media (max-width: 700px) {
            .glass-card { width: 85%; padding: 40px 20px; max-height: 90vh; overflow-y: auto; }
            .name { font-size: 2rem; }
            .role { flex-direction: column; gap: 5px; margin-bottom: 25px; }
            .separator { display: none; }
            .btns { flex-direction: column; width: 100%; gap: 15px; }
            .btn { width: 100%; box-sizing: border-box; text-align: center; }
            .hint-corner, .speed-hud { display: none; }
            .terminal-text { font-size: 12px; }
            #context-menu { display: none; }
        }
        
        /* 键盘提示隐藏 */
        .hint-corner { display: none; } /* 为了极致纯净，默认隐藏，仅在输入时触发显示逻辑 */
    </style>
</head>
<body>

    <canvas id="startrack"></canvas>
    <div class="vignette"></div>
    
    <div id="boot-screen">
        <div class="terminal-text" id="terminal-content"></div>
    </div>

    <div id="toast">System: Ready</div>

    <div class="speed-hud" id="ui-hud">
        <div class="hud-text" id="speed-text">SPEED: 1.00x</div>
        <div class="speed-bar-container">
            <div class="speed-bar" id="speed-bar"></div>
        </div>
    </div>

    <div id="context-menu">
        <div class="ctx-ring"></div>
        <div class="ctx-item ctx-top" id="ctx-warp">WARP</div>
        <div class="ctx-item ctx-right" id="ctx-rgb">RGB</div>
        <div class="ctx-item ctx-bottom" id="ctx-reset">RESET</div>
        <div class="ctx-item ctx-left" id="ctx-freeze">STOP</div>
    </div>

    <div class="main" id="main-content">
        <div class="glass-card" id="tilt-card">
            <div class="avatar-container" id="avatar-btn">
                <div class="orbit-ring" id="orbit-ring"></div>
                <img src="https://s2.loli.net/2024/08/14/UuaJ1elnkKgGChN.jpg" class="avatar-img" id="avatar-img" alt="头像">
            </div>
            
            <div class="name">嘎嘎sama | 今予</div>
            
            <div class="role">
                <span>Zhejiang University</span>
                <span class="separator">|</span>
                <span>Mechanical Engineering</span>
            </div>

            <div class="btns">
                <a href="https://notion-next-is5zr145w-hjys-projects-4f1ab78d.vercel.app/" target="_blank" class="btn">博客</a>
                <a href="https://github.com/JYbestow" target="_blank" class="btn">Github</a>
                <a href="https://space.bilibili.com/402611949?spm_id_from=333.1007.0.0" target="_blank" class="btn">bilibili</a>
            </div>
        </div>
    </div>

    <script src="./zepto.min.js"></script>

    <script>
        console.log("%c ZJU ENGINEER \n%c System Optimized.", "font-size: 16px; color: #fff; font-weight: bold;", "font-size: 12px; color: #888;");

        window.requestAnimFrame = (function() { return window.requestAnimationFrame || function(callback) { window.setTimeout(callback, 1000 / 60); }; })();

        $(function() {
            // --- 引导文字 (更简洁) ---
            const lines = [
                "SYSTEM BOOT...",
                "LOADING ASTROPHYSICS ENGINE... [OK]",
                "--------------------------------",
                "INTERACTIONS:",
                "> SCROLL : TIME DILATION",
                "> HOLD   : GRAVITY WELL",
                "> R-CLICK: TACTICAL MENU",
                "--------------------------------",
                "CLICK TO START"
            ];
            
            const termContent = document.getElementById('terminal-content');
            const bootScreen = document.getElementById('boot-screen');
            const mainContent = document.getElementById('main-content');
            const uiHud = document.getElementById('ui-hud');
            
            let lineIndex = 0; let charIndex = 0;
            function typeWriter() {
                if (lineIndex < lines.length) {
                    const currentLine = lines[lineIndex];
                    if (lineIndex === lines.length - 1) {
                        const div = document.createElement('div');
                        div.className = 'cmd-line highlight';
                        div.innerHTML = currentLine;
                        termContent.appendChild(div);
                        lineIndex++;
                    } else {
                        if (charIndex === 0) {
                            const div = document.createElement('div');
                            div.className = 'cmd-line';
                            div.id = 'line-' + lineIndex;
                            termContent.appendChild(div);
                        }
                        const currentDiv = document.getElementById('line-' + lineIndex);
                        currentDiv.textContent += currentLine.charAt(charIndex);
                        charIndex++;
                        if (charIndex < currentLine.length) setTimeout(typeWriter, 10);
                        else { charIndex = 0; lineIndex++; setTimeout(typeWriter, 50); }
                    }
                }
            }
            setTimeout(typeWriter, 200);

            function closeBoot() {
                bootScreen.classList.add('system-off');
                mainContent.classList.add('loaded');
                setTimeout(() => { uiHud.classList.add('show'); }, 800);
            }
            bootScreen.addEventListener('click', closeBoot);
            bootScreen.addEventListener('touchstart', closeBoot);

            // --- 核心系统 ---
            const canvas = document.getElementById('startrack');
            const ctx = canvas.getContext('2d');
            let cw, ch;
            function resize() { cw = window.innerWidth; ch = window.innerHeight; canvas.width = cw; canvas.height = ch; }
            resize(); window.addEventListener('resize', resize);

            let mx = 0, my = 0; let rawMx = 0, rawMy = 0;
            document.addEventListener('mousemove', (e) => {
                rawMx = e.clientX; rawMy = e.clientY;
                mx = (e.clientX - cw / 2) / cw; my = (e.clientY - ch / 2) / ch;
                const card = document.getElementById('tilt-card');
                if (card) card.style.transform = `perspective(1000px) rotateX(${-my * 10}deg) rotateY(${mx * 10}deg)`;
            });
            document.addEventListener('mouseleave', () => {
                const card = document.getElementById('tilt-card');
                if (card) card.style.transform = `perspective(1000px) rotateX(0) rotateY(0)`;
            });

            let globalSpeed = 1.0; let warpSpeed = 1.0;
            let isWarping = false; let rainbowMode = false; let isSucking = false;
            
            const speedText = document.getElementById('speed-text');
            const speedBar = document.getElementById('speed-bar');
            function updateSpeedUI() {
                speedText.innerText = `SPEED: ${globalSpeed.toFixed(2)}x`;
                let pct = (globalSpeed + 2) / 7 * 100;
                speedBar.style.width = `${Math.max(0, Math.min(100, pct))}%`;
            }

            document.addEventListener('wheel', (e) => {
                e.preventDefault();
                globalSpeed -= e.deltaY * 0.001; 
                if(globalSpeed > 5) globalSpeed = 5; if(globalSpeed < -2) globalSpeed = -2;
                updateSpeedUI();
            }, { passive: false });

            // --- 右键菜单 ---
            const ctxMenu = document.getElementById('context-menu');
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                let x = e.clientX; let y = e.clientY;
                ctxMenu.style.left = (x - 70) + 'px'; 
                ctxMenu.style.top = (y - 70) + 'px';
                ctxMenu.classList.add('visible');
            });
            document.addEventListener('click', (e) => { if(!e.target.closest('#context-menu')) ctxMenu.classList.remove('visible'); });

            // 菜单逻辑
            function menuAction(msg) {
                showToast(msg); ctxMenu.classList.remove('visible');
            }
            document.getElementById('ctx-warp').addEventListener('click', () => { document.getElementById('avatar-btn').click(); menuAction("Warp Engaged"); });
            document.getElementById('ctx-rgb').addEventListener('click', () => { rainbowMode = !rainbowMode; menuAction(rainbowMode ? "RGB: On" : "RGB: Off"); });
            document.getElementById('ctx-freeze').addEventListener('click', () => { globalSpeed = 0; updateSpeedUI(); menuAction("Time Frozen"); });
            document.getElementById('ctx-reset').addEventListener('click', () => { globalSpeed = 1.0; rainbowMode = false; updateSpeedUI(); menuAction("Reset"); });

            // --- 视觉类 ---
            class Shockwave {
                constructor(x, y) { this.x = x; this.y = y; this.r = 1; this.life = 1.0; }
                update() { this.r += 15; this.life -= 0.02; }
                draw() {
                    if(this.life <= 0) return;
                    ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${this.life * 0.1})`; // 更加微弱的冲击波
                    ctx.lineWidth = 1; ctx.stroke();
                }
            }
            const shockwaves = [];

            class ShootingStar {
                constructor() { this.reset(); }
                reset() {
                    this.x = Math.random() * cw; this.y = Math.random() * ch;
                    this.len = Math.random() * 80 + 20;
                    this.speed = Math.random() * 10 + 10; // 更快
                    this.size = Math.random() * 0.8 + 0.1; // 更细
                    this.life = 0; this.waitTime = Math.random() * 200; // 更稀有
                    this.active = false; this.angle = Math.PI / 4 + (Math.random() - 0.5) * 0.2; 
                }
                update() {
                    if (this.waitTime > 0) { this.waitTime--; return; }
                    this.active = true;
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed;
                    this.life++;
                    if (this.x > cw + 100 || this.y > ch + 100) this.reset();
                }
                draw() {
                    if (!this.active) return;
                    const endX = this.x - Math.cos(this.angle) * this.len;
                    const endY = this.y - Math.sin(this.angle) * this.len;
                    const grad = ctx.createLinearGradient(this.x, this.y, endX, endY);
                    grad.addColorStop(0, "rgba(255, 255, 255, 0.8)");
                    grad.addColorStop(1, "rgba(255, 255, 255, 0)");
                    ctx.strokeStyle = grad; ctx.lineWidth = this.size;
                    ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(endX, endY); ctx.stroke();
                }
            }
            const meteors = []; for(let i=0; i<4; i++) meteors.push(new ShootingStar());

            class Star {
                constructor() { this.reset(); this.angle = Math.random() * Math.PI * 2; }
                reset() {
                    this.r = Math.random() * cw * 0.6 + 50;
                    this.baseOmega = (Math.random() * 0.5 + 0.5) * 800 / Math.pow(this.r, 1.5);
                    this.size = Math.random() * 1.5 + 0.2;
                    // 【配色升级】天体物理色调：钻石白、冰川蓝、极少量淡金
                    const rand = Math.random();
                    let colorStr;
                    if(rand > 0.9) colorStr = "200, 220, 255"; // 蓝巨星
                    else if(rand > 0.6) colorStr = "255, 255, 255"; // 主序星
                    else colorStr = "255, 245, 230"; // 老年恒星
                    
                    this.baseColor = colorStr;
                    this.alpha = Math.random() * 0.5 + 0.3;
                    this.hue = Math.random() * 360; this.ox = 0; this.oy = 0;
                    // 呼吸闪烁参数
                    this.blinkSpeed = Math.random() * 0.05;
                    this.blinkVal = Math.random() * Math.PI;
                }
                update() {
                    this.angle += this.baseOmega * 0.05 * warpSpeed * globalSpeed; 
                    this.blinkVal += this.blinkSpeed;
                    if(rainbowMode) this.hue += 2;
                    
                    // 物理计算
                    const curX = cw / 2 + Math.cos(this.angle) * this.r + this.ox;
                    const curY = ch / 2 + Math.sin(this.angle) * this.r + this.oy;
                    
                    if (isSucking) {
                        const dx = rawMx - curX; const dy = rawMy - curY;
                        const distSq = dx*dx + dy*dy;
                        const force = 5000 / (distSq + 1000); 
                        this.ox += (dx / Math.sqrt(distSq)) * force * 5;
                        this.oy += (dy / Math.sqrt(distSq)) * force * 5;
                    }
                    shockwaves.forEach(wave => {
                        const dx = curX - wave.x; const dy = curY - wave.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if (Math.abs(dist - wave.r) < 30) {
                            const pushForce = 5 * wave.life; // 减弱推力，更优雅
                            this.ox += (dx / dist) * pushForce;
                            this.oy += (dy / dist) * pushForce;
                        }
                    });
                    this.ox *= 0.92; this.oy *= 0.92;
                }
                draw() {
                    const x = cw / 2 + Math.cos(this.angle) * this.r - mx * 20 + this.ox; // 减弱视差
                    const y = ch / 2 + Math.sin(this.angle) * this.r - my * 20 + this.oy;
                    
                    ctx.beginPath(); ctx.arc(x, y, this.size, 0, Math.PI * 2);
                    
                    // 呼吸效果
                    let blinkAlpha = this.alpha + Math.sin(this.blinkVal) * 0.2;
                    
                    if (rainbowMode) ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, 0.8)`;
                    else if (isWarping) ctx.fillStyle = `rgba(200, 255, 255, 0.9)`;
                    else ctx.fillStyle = `rgba(${this.baseColor}, ${Math.max(0.1, blinkAlpha)})`;
                    
                    ctx.fill();
                }
            }
            const stars = []; for (let i = 0; i < 1200; i++) stars.push(new Star());

            const particles = [];
            class Particle {
                constructor(x, y) {
                    this.x = x; this.y = y;
                    const angle = Math.random() * Math.PI * 2; const speed = Math.random() * 3 + 1; // 减慢爆炸速度
                    this.vx = Math.cos(angle) * speed; this.vy = Math.sin(angle) * speed;
                    this.life = 1; 
                }
                update() { this.x += this.vx; this.y += this.vy; this.vy += 0.1; this.life -= 0.03; }
                draw() {
                    ctx.globalAlpha = this.life; ctx.fillStyle = `rgba(255, 255, 255, 0.8)`;
                    ctx.beginPath(); ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2);
                    ctx.fill(); ctx.globalAlpha = 1;
                }
            }

            document.addEventListener('mousedown', (e) => {
                if(e.target.closest('#avatar-btn') || e.target.closest('#context-menu')) return;
                if(e.button === 0) {
                    shockwaves.push(new Shockwave(e.clientX, e.clientY));
                    isSucking = true;
                    for(let i=0; i<4; i++) particles.push(new Particle(e.clientX, e.clientY));
                }
            });
            document.addEventListener('mouseup', () => { isSucking = false; });

            const avatarBtn = document.getElementById('avatar-btn');
            const avatarImg = document.getElementById('avatar-img');
            const toast = document.getElementById('toast');
            
            function showToast(msg) {
                toast.innerText = msg; toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            }

            avatarBtn.addEventListener('click', (e) => {
                e.stopPropagation(); if(isWarping) return;
                isWarping = true; avatarBtn.classList.add('warp-active'); avatarImg.classList.add('spin-warp');
                let accelInterval = setInterval(() => { if(warpSpeed < 20) warpSpeed += 1; }, 50);
                showToast("Warp Drive Engaged");
                setTimeout(() => {
                    clearInterval(accelInterval);
                    const decelInterval = setInterval(() => {
                        if(warpSpeed > 1) { warpSpeed -= 1; } else {
                            warpSpeed = 1; isWarping = false;
                            avatarBtn.classList.remove('warp-active'); avatarImg.classList.remove('spin-warp');
                            clearInterval(decelInterval);
                        }
                    }, 50);
                }, 2000);
            });

            // Konami Code 逻辑保留但UI隐藏，作为真·彩蛋
            const konamiCode = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
            let konamiIndex = 0;
            document.addEventListener('keydown', (e) => {
                if (e.key === konamiCode[konamiIndex]) {
                    konamiIndex++;
                    if (konamiIndex === konamiCode.length) {
                        rainbowMode = !rainbowMode;
                        showToast(rainbowMode ? "RGB: On" : "RGB: Off");
                        konamiIndex = 0;
                    }
                } else { konamiIndex = 0; }
            });

            function loop() {
                // 【核心优化】使用 destination-out 制造极其干净的拖尾
                ctx.globalCompositeOperation = 'destination-out';
                let alpha = (isWarping || Math.abs(globalSpeed) > 3) ? 0.05 : 0.2; // 平时拖尾短，干净；加速时拖尾长
                ctx.fillStyle = `rgba(0, 0, 0, ${alpha})`;
                ctx.fillRect(0, 0, cw, ch);

                ctx.globalCompositeOperation = 'lighter';
                stars.forEach(s => { s.update(); s.draw(); });
                meteors.forEach(m => { m.update(); m.draw(); });
                shockwaves.forEach((wave, i) => { wave.update(); wave.draw(); if(wave.life<=0) shockwaves.splice(i,1); });

                ctx.globalCompositeOperation = 'source-over';
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update(); particles[i].draw();
                    if (particles[i].life <= 0) particles.splice(i, 1);
                }
                requestAnimFrame(loop);
            }
            loop();
        });
    </script>
</body>
</html>
